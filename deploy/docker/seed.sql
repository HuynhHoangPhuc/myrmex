-- Myrmex demo seed data
-- Idempotent: uses ON CONFLICT DO NOTHING / DO UPDATE
-- Run: make seed

BEGIN;

-- =====================================================================
-- 0. Core: Demo admin user
--    email: admin@myrmex.dev  password: demo1234
-- =====================================================================
INSERT INTO core.users (id, email, password_hash, full_name, role, is_active)
VALUES (
  '00000000-0000-0000-0000-000000000001',
  'admin@myrmex.dev',
  '$2b$12$SXaQW37wRUZMFheHe/xhPeg0yN/EC0D89uXN1h9G4Ltvv/8rqKyNe',
  'Demo Admin',
  'admin',
  true
)
ON CONFLICT (id) DO NOTHING;

-- =====================================================================
-- 1. HR: Departments
-- =====================================================================
INSERT INTO hr.departments (id, name, code)
VALUES
  ('00000000-0000-0000-0000-000000000001', 'Computer Science', 'CS'),
  ('00000000-0000-0000-0000-000000000002', 'Mathematics',      'MATH'),
  ('00000000-0000-0000-0000-000000000003', 'Physics',          'PHYS')
ON CONFLICT (id) DO NOTHING;

-- =====================================================================
-- 2. HR: Teachers
-- =====================================================================
INSERT INTO hr.teachers (id, employee_code, full_name, email, department_id, max_hours_per_week, title, is_active)
VALUES
  ('00000000-0000-0001-0000-000000000001', 'EMP001', 'Alice Nguyen',  'alice@myrmex.dev', '00000000-0000-0000-0000-000000000001', 20, 'Dr.', true),
  ('00000000-0000-0001-0000-000000000002', 'EMP002', 'Bob Tran',      'bob@myrmex.dev',   '00000000-0000-0000-0000-000000000001', 18, 'MSc.', true),
  ('00000000-0000-0001-0000-000000000003', 'EMP003', 'Carol Le',      'carol@myrmex.dev', '00000000-0000-0000-0000-000000000002', 20, 'Dr.', true),
  ('00000000-0000-0001-0000-000000000004', 'EMP004', 'David Pham',    'david@myrmex.dev', '00000000-0000-0000-0000-000000000002', 16, 'MSc.', true),
  ('00000000-0000-0001-0000-000000000005', 'EMP005', 'Eve Hoang',     'eve@myrmex.dev',   '00000000-0000-0000-0000-000000000003', 20, 'Dr.', true),
  ('00000000-0000-0001-0000-000000000006', 'EMP006', 'Frank Do',      'frank@myrmex.dev', '00000000-0000-0000-0000-000000000003', 18, 'MSc.', true),
  ('00000000-0000-0001-0000-000000000007', 'EMP007', 'Grace Vu',      'grace@myrmex.dev', '00000000-0000-0000-0000-000000000001', 16, 'MSc.', true),
  ('00000000-0000-0001-0000-000000000008', 'EMP008', 'Henry Ly',      'henry@myrmex.dev', '00000000-0000-0000-0000-000000000002', 20, 'Dr.', true)
ON CONFLICT (id) DO NOTHING;

-- =====================================================================
-- 3. HR: Teacher specializations (junction table)
-- =====================================================================
INSERT INTO hr.teacher_specializations (teacher_id, specialization)
VALUES
  -- Alice Nguyen: CS, ALGO
  ('00000000-0000-0001-0000-000000000001', 'CS'),
  ('00000000-0000-0001-0000-000000000001', 'ALGO'),
  -- Bob Tran: CS, DB
  ('00000000-0000-0001-0000-000000000002', 'CS'),
  ('00000000-0000-0001-0000-000000000002', 'DB'),
  -- Carol Le: MATH, CALC
  ('00000000-0000-0001-0000-000000000003', 'MATH'),
  ('00000000-0000-0001-0000-000000000003', 'CALC'),
  -- David Pham: MATH, STAT
  ('00000000-0000-0001-0000-000000000004', 'MATH'),
  ('00000000-0000-0001-0000-000000000004', 'STAT'),
  -- Eve Hoang: PHYS, MECH
  ('00000000-0000-0001-0000-000000000005', 'PHYS'),
  ('00000000-0000-0001-0000-000000000005', 'MECH'),
  -- Frank Do: PHYS, ELEC
  ('00000000-0000-0001-0000-000000000006', 'PHYS'),
  ('00000000-0000-0001-0000-000000000006', 'ELEC'),
  -- Grace Vu: CS, NET
  ('00000000-0000-0001-0000-000000000007', 'CS'),
  ('00000000-0000-0001-0000-000000000007', 'NET'),
  -- Henry Ly: MATH, ALGO
  ('00000000-0000-0001-0000-000000000008', 'MATH'),
  ('00000000-0000-0001-0000-000000000008', 'ALGO')
ON CONFLICT DO NOTHING;

-- =====================================================================
-- 4. HR: Teacher availability (Mon=1..Fri=5, periods 1-6)
--    One row per (teacher, day, start_period); end_period = start_period+1.
-- =====================================================================
INSERT INTO hr.teacher_availability (teacher_id, day_of_week, start_period, end_period)
SELECT
  t.id,
  d.day,
  p.period,
  p.period + 1
FROM
  (VALUES
    ('00000000-0000-0001-0000-000000000001'::uuid),
    ('00000000-0000-0001-0000-000000000002'::uuid),
    ('00000000-0000-0001-0000-000000000003'::uuid),
    ('00000000-0000-0001-0000-000000000004'::uuid),
    ('00000000-0000-0001-0000-000000000005'::uuid),
    ('00000000-0000-0001-0000-000000000006'::uuid),
    ('00000000-0000-0001-0000-000000000007'::uuid),
    ('00000000-0000-0001-0000-000000000008'::uuid)
  ) AS t(id)
  CROSS JOIN (VALUES (1),(2),(3),(4),(5))       AS d(day)
  CROSS JOIN (VALUES (1),(2),(3),(4),(5),(6))   AS p(period)
ON CONFLICT (teacher_id, day_of_week, start_period) DO NOTHING;

-- =====================================================================
-- 5. Subject: Subjects (department_id stored as text)
-- =====================================================================
INSERT INTO subject.subjects (id, code, name, credits, department_id, weekly_hours, is_active)
VALUES
  ('00000000-0000-0002-0000-000000000001', 'CS101',    'Intro to Programming',   3, '00000000-0000-0000-0000-000000000001', 3, true),
  ('00000000-0000-0002-0000-000000000002', 'CS201',    'Data Structures',         3, '00000000-0000-0000-0000-000000000001', 3, true),
  ('00000000-0000-0002-0000-000000000003', 'CS301',    'Algorithms',              3, '00000000-0000-0000-0000-000000000001', 3, true),
  ('00000000-0000-0002-0000-000000000004', 'DB101',    'Database Systems',        3, '00000000-0000-0000-0000-000000000001', 3, true),
  ('00000000-0000-0002-0000-000000000005', 'NET101',   'Computer Networks',       3, '00000000-0000-0000-0000-000000000001', 3, true),
  ('00000000-0000-0002-0000-000000000006', 'MATH101',  'Calculus I',              3, '00000000-0000-0000-0000-000000000002', 3, true),
  ('00000000-0000-0002-0000-000000000007', 'MATH201',  'Calculus II',             3, '00000000-0000-0000-0000-000000000002', 3, true),
  ('00000000-0000-0002-0000-000000000008', 'STAT101',  'Statistics',              3, '00000000-0000-0000-0000-000000000002', 3, true),
  ('00000000-0000-0002-0000-000000000009', 'PHYS101',  'Mechanics',               3, '00000000-0000-0000-0000-000000000003', 3, true),
  ('00000000-0000-0002-0000-000000000010', 'PHYS201',  'Electromagnetism',        3, '00000000-0000-0000-0000-000000000003', 3, true)
ON CONFLICT (id) DO NOTHING;

-- =====================================================================
-- 6. Subject: Prerequisites
-- =====================================================================
INSERT INTO subject.prerequisites (subject_id, prerequisite_id, type, priority)
VALUES
  -- CS101 → CS201 → CS301 (hard/strict)
  ('00000000-0000-0002-0000-000000000002', '00000000-0000-0002-0000-000000000001', 'hard', 1),
  ('00000000-0000-0002-0000-000000000003', '00000000-0000-0002-0000-000000000002', 'hard', 1),
  -- CS101 → DB101 (soft/recommended)
  ('00000000-0000-0002-0000-000000000004', '00000000-0000-0002-0000-000000000001', 'soft', 2),
  -- MATH101 → MATH201 (hard)
  ('00000000-0000-0002-0000-000000000007', '00000000-0000-0002-0000-000000000006', 'hard', 1),
  -- MATH101 → STAT101 (soft)
  ('00000000-0000-0002-0000-000000000008', '00000000-0000-0002-0000-000000000006', 'soft', 2),
  -- PHYS101 → PHYS201 (hard)
  ('00000000-0000-0002-0000-000000000010', '00000000-0000-0002-0000-000000000009', 'hard', 1)
ON CONFLICT DO NOTHING;

-- =====================================================================
-- 7. Timetable: Rooms
-- =====================================================================
INSERT INTO timetable.rooms (id, name, capacity, type, features, is_active)
VALUES
  ('00000000-0000-0003-0000-000000000001', 'Room A101',    40, 'lecture', '{}', true),
  ('00000000-0000-0003-0000-000000000002', 'Room A102',    40, 'lecture', '{}', true),
  ('00000000-0000-0003-0000-000000000003', 'Lab B201',     30, 'lab',     '{"computers"}', true),
  ('00000000-0000-0003-0000-000000000004', 'Seminar C101', 20, 'seminar', '{}', true),
  ('00000000-0000-0003-0000-000000000005', 'Room D301',    50, 'lecture', '{}', true)
ON CONFLICT (id) DO NOTHING;

-- =====================================================================
-- 8. Timetable: Semester Spring 2026
-- =====================================================================
INSERT INTO timetable.semesters (id, name, year, term, start_date, end_date, offered_subject_ids)
VALUES (
  '00000000-0000-0004-0000-000000000001',
  'Spring 2026',
  2026,
  1,
  '2026-01-06',
  '2026-05-31',
  ARRAY[
    '00000000-0000-0002-0000-000000000001'::uuid,
    '00000000-0000-0002-0000-000000000002'::uuid,
    '00000000-0000-0002-0000-000000000003'::uuid,
    '00000000-0000-0002-0000-000000000004'::uuid,
    '00000000-0000-0002-0000-000000000005'::uuid,
    '00000000-0000-0002-0000-000000000006'::uuid,
    '00000000-0000-0002-0000-000000000007'::uuid,
    '00000000-0000-0002-0000-000000000008'::uuid,
    '00000000-0000-0002-0000-000000000009'::uuid,
    '00000000-0000-0002-0000-000000000010'::uuid
  ]
)
ON CONFLICT (id) DO NOTHING;

-- =====================================================================
-- 9. Timetable: Time slots — Mon(1)–Fri(5), periods 1–6
--    Each slot: start_period = period, end_period = period + 1
-- =====================================================================
INSERT INTO timetable.time_slots (id, semester_id, day_of_week, start_period, end_period)
SELECT
  -- Deterministic UUID from (day, period): encode in bytes 10-15
  ('00000000-0000-0005-' ||
   LPAD(CAST(d.day AS text), 4, '0') ||
   '-' ||
   LPAD(CAST(p.period AS text), 12, '0'))::uuid,
  '00000000-0000-0004-0000-000000000001',
  d.day,
  p.period,
  p.period + 1
FROM
  (VALUES (1),(2),(3),(4),(5))       AS d(day)
  CROSS JOIN (VALUES (1),(2),(3),(4),(5),(6)) AS p(period)
ON CONFLICT (id) DO NOTHING;

COMMIT;
